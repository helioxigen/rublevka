version: "3"
services:
  jq_postgres_test:
    image: jq_postgres_test
    container_name: jq_postgres_test
    build:
      context: ../
      dockerfile: ./run_tests_in_docker/test_db.Dockerfile
    env_file:
      - common.env
    ports:
      - "5100:5432"
    networks:
      master_network:
        aliases:
          - jq_postgres_test
  jq_backend_test:
    image: jq_backend_test
    container_name: jq_backend_test
    build:
      context: ../../
      dockerfile: tests/run_tests_in_docker/tests_app.Dockerfile
    depends_on:
      - jq_postgres_test
    env_file:
      - common.env
      - local.env
    environment:
      - APP_CONFIG=testing
      - POSTGRES_HOST=jq_postgres_test
    ports:
      - 5000:5000
    volumes:
      - ../../:/home/app
    working_dir: /home/app
    entrypoint: ["/bin/sh", "-c", "python -B -m pytest"]
    networks:
      master_network:
        aliases:
          - jq_backend_test
networks:
  master_network:
    external: true
volumes:
  jq_pgdata_test:
