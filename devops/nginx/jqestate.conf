server {
  listen 80;
  server_name www.jq.estate;
#  rewrite ^/(.*)$ https://jq.estate/$1 permanent;
}

server {
  server_name jq.estate;

  location ~ ^/(buy|rent|settlements) {
    rewrite ^\/settlements\/638\/?$ /country/places/settlements/517 permanent;
    rewrite ^\/settlements\/475\/?$ /country/places/settlements/453 permanent;
    rewrite ^\/settlements\/492\/?$ /country/places/settlements/1276 permanent;
    rewrite ^\/settlements\/275\/?$ /country/places/settlements/1634 permanent;
    rewrite ^\/settlements\/622\/?$ /country/places/settlements/474 permanent;
    rewrite ^\/settlements\/503\/?$ /country/places/settlements/407 permanent;
    rewrite ^\/settlements\/618\/?$ /country/places/settlements/332 permanent;
    rewrite ^\/settlements\/641\/?$ /country/places/settlements/368 permanent;
    rewrite ^\/settlements\/616\/?$ /country/places/settlements/494 permanent;
    rewrite ^\/settlements\/626\/?$ /country/places/settlements/276 permanent;
    rewrite ^\/settlements\/563\/?$ /country/places/settlements/542 permanent;
    rewrite ^\/settlements\/490\/?$ /country/places/settlements/529 permanent;
    rewrite ^\/settlements\/414\/?$ /country/places/settlements/226 permanent;
    rewrite ^\/settlements\/478\/?$ /country/places/settlements/474 permanent;
    rewrite ^\/settlements\/410\/?$ /country/places/settlements/1247 permanent;
    rewrite ^\/settlements\/603\/?$ /country/places/settlements/497 permanent;
    rewrite ^\/settlements\/415\/?$ /country/places/settlements/438 permanent;
    rewrite ^\/settlements\/575\/?$ /country/places/settlements/614 permanent;
    rewrite ^\/settlements\/644\/?$ /country/places/settlements/497 permanent;
    rewrite ^\/settlements\/(\d+)\/?$ /country/places/settlements/$1 permanent;
    rewrite ^\/settlements\/? /country/places/settlements permanent;
    rewrite ^\/buy\/A001-(\d+)\/?$ /country/properties/sale/house/$1 permanent;
    rewrite ^\/buy\/? /country/properties/sale permanent;
    rewrite ^\/rent\/A001-(\d+)\/?$ /country/properties/rent/house/$1 permanent;
    rewrite ^\/rent\/? /country/properties/rent permanent;
  }

  location / {
    rewrite "^/zagorodnaya/(.*)undefined(.*)" /zagorodnaya permanent;

    rewrite "^/zagorodnaya/prodaja/dom/([^\d]+)" /zagorodnaya/prodaja/dom permanent;

    rewrite "^/gorodskaya/arenda/kvartira(.*)" /zagorodnaya/arenda/kvartira permanent;
    rewrite "^/gorodskaya/arenda/apartamenty(.*)" /zagorodnaya/arenda/taunhaus permanent;
    rewrite "^/gorodskaya/arenda(.*)" /zagorodnaya/arenda permanent;
    rewrite "^/gorodskaya/prodaja/kvartira(.*)" /zagorodnaya/prodaja/kvartira permanent;
    rewrite "^/gorodskaya/prodaja/apartamenty(.*)" /zagorodnaya/prodaja/taunhaus permanent;
    rewrite "^/gorodskaya/prodaja/penthaus(.*)" /zagorodnaya/prodaja/dom permanent;
    rewrite "^/gorodskaya/prodaja(.*)" /zagorodnaya/prodaja permanent;

    rewrite "^/rublevka/razdory/" /country/places/settlements/234 permanent;
    rewrite "^/rublevka/nikolino/" /country/places/settlements/235 permanent;
    rewrite "^/rublevka/sosnovyy-bor/" /country/places/settlements/238 permanent;
    rewrite "^/rublevka/jukovka/" /country/places/settlements/238 permanent;
    rewrite "^/rublevka/landshaft/" /country/places/settlements/244 permanent;
    rewrite "^/rublevka/gorki-8/" /country/places/settlements/250 permanent;
    rewrite "^/rublevka/gorki-2/" /country/places/settlements/429 permanent;
    rewrite "^/rublevka/nikolina-gora/" /country/places/settlements/289 permanent;
    rewrite "^/rublevka/usovo/" /country/places/settlements/301 permanent;
    rewrite "^/rublevka/barviha/" /country/places/settlements/314 permanent;
    rewrite "^/rublevka/lesnoy-ruchey/" /country/places/settlements/497 permanent;
    rewrite "^/rublevka/sady-meyyendorf/" /country/places/settlements/256 permanent;
    rewrite "^/rublevka/kotton-vey/" /country/places/settlements/224 permanent;
    rewrite "^/rent-rublevka/barvikha/" /country/places/settlements/314/properties/rent permanent;
    rewrite "^/rent-rublevka/zhukovka/" /country/places/settlements/241/properties/rent permanent;
    rewrite "^/rent-rublevka/gorki-8/" /country/places/settlements/250/properties/rent permanent;
    rewrite "^/rent-rublevka/razdory/" /country/places/settlements/234/properties/rent permanent;
    rewrite "^/rent-rublevka/nikolina-gora/" /country/places/settlements/289/properties/rent permanent;
    rewrite "^/rent-rublevka/nikolino/" /country/places/settlements/235/properties/rent permanent;
    rewrite "^/rent-rublevka/gorki-2/" /country/places/settlements/429/properties/rent permanent;
    rewrite "^/rent-rublevka/usovo/" /country/places/settlements/301/properties/rent permanent;
    rewrite "^/rent-rublevka/jukovka21/" /country/places/settlements/242/properties/rent permanent;
    rewrite "^/rent-rublevka/sady-meyyendorf/" /country/places/settlements/256/properties/rent permanent;
    rewrite "^/rent-rublevka/rechnoy/" /country/places/settlements/231/properties/rent permanent;
    rewrite "^/kievskoe/grafskiye-prudy/" /country/places/settlements/476 permanent;
    rewrite "^/kievskoe/promenad/" /country/places/settlements/484 permanent;
    rewrite "^/kievskoe/krekshino/" /country/places/settlements/478 permanent;
    rewrite "^/minskoe/peredelkino/" /country/places/settlements/546 permanent;
    rewrite "^/minskoe/nemchinovka/" /country/places/settlements/491 permanent;
    rewrite "^/minskoe/truvil/" /country/places/settlements/498 permanent;
    rewrite "^/minskoe/dovil/" /country/places/settlements/499 permanent;
    rewrite "^/minskoe/gribovo/" /country/places/settlements/501 permanent;
    rewrite "^/novaya-riga/benilyuks/" /country/places/settlements/366 permanent;
    rewrite "^/novaya-riga/knyazhye-ozero/" /country/places/settlements/361 permanent;
    rewrite "^/novaya-riga/pavlovo/" /country/places/settlements/365 permanent;
    rewrite "^/novaya-riga/poljanka/" /country/places/settlements/380 permanent;
    rewrite "^/novaya-riga/nikolskaya-sloboda/" /country/places/settlements/357 permanent;
    rewrite "^/novaya-riga/mozzhinka/" /country/places/settlements/406 permanent;
    rewrite "^/novaya-riga/arhangelskoe/" /country/places/settlements/434 permanent;
    rewrite "^/novaya-riga/myakinino/" /country/places/settlements/393 permanent;
    rewrite "^/novaya-riga/agalarov-estate/" /country/places/settlements/384 permanent;
    rewrite "^/novaya-riga/monolit/" /country/places/settlements/382 permanent;
    rewrite "^/novaya-riga/pavlovskaja-sloboda/" /country/places/settlements/565 permanent;
    rewrite "^/novaya-riga/onegino/" /country/places/settlements/386 permanent;
    rewrite "^/novaya-riga/tretja-ohota/" /country/places/settlements/375 permanent;
    rewrite "^/novaya-riga/riversajd/" /country/places/settlements/373 permanent;
    rewrite "^/novaya-riga/novahovo/" /country/places/settlements/355 permanent;
    rewrite "^/novaya-riga/sherwood/" /country/places/settlements/363 permanent;
    rewrite "^/novaya-riga/grin-hill/" /country/places/settlements/381 permanent;
    rewrite "^/novaya-riga/pavlovo-2/" /country/places/settlements/371 permanent;
    rewrite "^/novaya-riga/millennium-park/" /country/places/settlements/368 permanent;
    rewrite "^/novaya-riga/montevill/" /country/places/settlements/392 permanent;
    rewrite "^/novaya-riga/greenfield/" /country/places/settlements/362 permanent;
    rewrite "^/novaya-riga/park-avenju/" /country/places/settlements/611 permanent;
    rewrite "^/novaya-riga/anosino/" /country/places/settlements/510 permanent;
    rewrite "^/novaya-riga/luzhki/" /country/places/settlements/377 permanent;
    rewrite "^/rent-novaya-riga/pavlovo/" /country/places/settlements/365/properties/rent permanent;
    rewrite "^/rent-novaya-riga/knyagye-ozero/" /country/places/settlements/361/properties/rent permanent;
    rewrite "^/rublevka" /country/places/routes/1178 permanent;
    rewrite "^/rent-rublevka/" /country/places/routes/1178/properties/rent permanent;
    rewrite "^/kaluzhskoe/" /country/places/routes/1183 permanent;
    rewrite "^/rent-kalugskoye/" /country/places/routes/1183/properties/rent permanent;
    rewrite "^/novaya-riga/" /country/places/routes/1186 permanent;
    rewrite "^/rent-novaya-riga/" /country/places/routes/1186/properties/rent permanent;
    rewrite "^/dmitrovskoe/" /country/places/routes/1185 permanent;
    rewrite "^/rent-dmitrovskoye/" /country/places/routes/1185/properties/rent permanent;
    rewrite "^/pjatnickoe/" /country/places/routes/1191 permanent;
    rewrite "^/rent-pyatnitskoye/" /country/places/routes/1191/properties/rent permanent;
    rewrite "^/minskoe/" /country/places/routes/1179 permanent;
    rewrite "^/rent-minskoye/" /country/places/routes/1179/properties/rent permanent;
    rewrite "^/kievskoe/" /country/places/routes/1177 permanent;
    rewrite "^/rent-kiyevskoye/" /country/places/routes/1177/properties/rent permanent;
    rewrite "^/novaya-riga/pokrovskoe/" /country/places/localities/1135 permanent;

    limit_req zone=perip burst=15 nodelay;
    limit_req zone=perserver burst=250;

    proxy_cache_valid 200 302 301 1h;
    expires 10m;
    proxy_pass http://localhost:8080;
  }

  location /api/ {
    proxy_pass https://api.jqestate.ru/;
  }

  location ~* .(woff|eot|ttf|svg|mp4|webm|jpg|jpeg|png|gif|ico|css|js)$ {
    proxy_cache_valid 200 365d;
    expires max;
    proxy_pass http://localhost:8080;
  }
}
