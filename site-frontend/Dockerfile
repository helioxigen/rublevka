FROM node:10.15-alpine

HEALTHCHECK CMD curl --fail http://localhost:8080/ || exit 1

RUN mkdir /app
WORKDIR /app
COPY . /app

ARG APP
ARG APP_ENV
ARG REACT_APP_ROISTAT_ID
ARG REACT_APP_FACEBOOK_PIXEL_ID
ARG REACT_APP_TARGETIX_PIXEL_ID
ARG BUILD_ID
ARG HOST

ENV APP=$APP
ENV APP_ENV=$APP_ENV
ENV REACT_APP_ROISTAT_ID=$REACT_APP_ROISTAT_ID
ENV REACT_APP_FACEBOOK_PIXEL_ID=$REACT_APP_FACEBOOK_PIXEL_ID
ENV REACT_APP_TARGETIX_PIXEL_ID=$REACT_APP_TARGETIX_PIXEL_ID
ENV BUILD_ID=$BUILD_ID
ENV HOST=$HOST

RUN yarn --ignore-engines
RUN NODE_ENV=production HOST=$HOST yarn build

RUN yarn global add @babel/core @babel/register
CMD NODE_ENV=production yarn start
